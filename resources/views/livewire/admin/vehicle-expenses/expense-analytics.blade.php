<div class="space-y-6"> {{-- En-tête --}} <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"> <div> <h1 class="text-2xl font-bold text-gray-900">Analytics des dépenses</h1> <p class="text-gray-600">Analyse détaillée de vos dépenses de flotte</p> </div> <div class="flex items-center gap-3"> <button wire:click="generateReport" class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"> <x-iconify icon="solar:document-text-bold" class="w-5 h-5" /> <span>Rapport PDF</span> </button> <div class="relative" x-data="{ open: false }"> <button @click="open = !open" class="inline-flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition"> <x-iconify icon="solar:export-bold" class="w-5 h-5" /> <span>Exporter</span> </button> <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10"> <button wire:click="exportData('csv')" class="block w-full text-left px-4 py-2 hover:bg-gray-100"> Export CSV </button> <button wire:click="exportData('excel')" class="block w-full text-left px-4 py-2 hover:bg-gray-100"> Export Excel </button> </div> </div> </div> </div> {{-- Filtres --}} <x-card> <div class="p-4 space-y-4"> <div class="grid grid-cols-1 md:grid-cols-5 gap-4"> <div> <x-input-label value="Période" /> <x-select wire:model.live="period" class="w-full"> <option value="month">Ce mois</option> <option value="quarter">Ce trimestre</option> <option value="year">Cette année</option> <option value="custom">Personnalisé</option> </x-select> </div> @if($period === 'custom') <div> <x-input-label value="Date début" /> <x-input type="date" wire:model.live="startDate" class="w-full" /> </div> <div> <x-input-label value="Date fin" /> <x-input type="date" wire:model.live="endDate" class="w-full" /> </div> @endif <div> <x-input-label value="Véhicule" /> <x-select wire:model.live="vehicle_id" class="w-full"> <option value="">Tous les véhicules</option> @foreach($vehicles as $vehicle) <option value="{{ $vehicle->id }}">{{ $vehicle->license_plate }}</option> @endforeach </x-select> </div> <div> <x-input-label value="Catégorie" /> <x-select wire:model.live="category" class="w-full"> <option value="">Toutes les catégories</option> @foreach($categories as $key => $label) <option value="{{ $key }}">{{ $label }}</option> @endforeach </x-select> </div> <div> <x-input-label value="Groupe" /> <x-select wire:model.live="expense_group_id" class="w-full"> <option value="">Tous les groupes</option> @foreach($expenseGroups as $group) <option value="{{ $group->id }}">{{ $group->name }}</option> @endforeach </x-select> </div> </div> </div> </x-card> {{-- Onglets de visualisation --}} <div class="border-b border-gray-200"> <nav class="-mb-px flex space-x-8"> <button wire:click="$set('viewMode', 'dashboard')" class="py-2 px-1 border-b-2 font-medium text-sm {{ $viewMode === 'dashboard' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' }}"> Dashboard </button> <button wire:click="$set('viewMode', 'tco')" class="py-2 px-1 border-b-2 font-medium text-sm {{ $viewMode === 'tco' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' }}"> TCO Véhicules </button> <button wire:click="$set('viewMode', 'trends')" class="py-2 px-1 border-b-2 font-medium text-sm {{ $viewMode === 'trends' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' }}"> Tendances </button> <button wire:click="$set('viewMode', 'suppliers')" class="py-2 px-1 border-b-2 font-medium text-sm {{ $viewMode === 'suppliers' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' }}"> Fournisseurs </button> <button wire:click="$set('viewMode', 'budgets')" class="py-2 px-1 border-b-2 font-medium text-sm {{ $viewMode === 'budgets' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' }}"> Budgets </button> </nav> </div> {{-- Contenu selon le mode d'affichage --}} @switch($viewMode) @case('dashboard') {{-- Vue Dashboard --}} <div class="grid grid-cols-1 md:grid-cols-4 gap-4"> @if($dashboardStats) <x-card class="p-4"> <div class="flex items-center justify-between"> <div> <p class="text-sm font-medium text-gray-600">Total dépenses</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($dashboardStats['total_amount'] ?? 0, 2) }} DZD </p> <p class="text-xs text-gray-500 mt-1"> {{ $dashboardStats['expense_count'] ?? 0 }} dépenses </p> </div> <div class="p-3 bg-blue-100 rounded-lg"> <x-iconify icon="solar:wallet-bold-duotone" class="w-6 h-6 text-blue-600" /> </div> </div> </x-card> <x-card class="p-4"> <div class="flex items-center justify-between"> <div> <p class="text-sm font-medium text-gray-600">Moyenne/véhicule</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($dashboardStats['avg_per_vehicle'] ?? 0, 2) }} DZD </p> <p class="text-xs text-gray-500 mt-1"> {{ $dashboardStats['vehicle_count'] ?? 0 }} véhicules </p> </div> <div class="p-3 bg-green-100 rounded-lg"> <x-iconify icon="solar:car-bold-duotone" class="w-6 h-6 text-green-600" /> </div> </div> </x-card> <x-card class="p-4"> <div class="flex items-center justify-between"> <div> <p class="text-sm font-medium text-gray-600">Top catégorie</p> <p class="text-xl font-bold text-gray-900"> {{ $dashboardStats['top_category']['name'] ?? 'N/A' }} </p> <p class="text-xs text-gray-500 mt-1"> {{ number_format($dashboardStats['top_category']['amount'] ?? 0, 0) }} DZD </p> </div> <div class="p-3 bg-indigo-100 rounded-lg"> <x-iconify icon="solar:tag-bold-duotone" class="w-6 h-6 text-indigo-600" /> </div> </div> </x-card> <x-card class="p-4"> <div class="flex items-center justify-between"> <div> <p class="text-sm font-medium text-gray-600">Score conformité</p> <p class="text-2xl font-bold {{ $complianceScore >= 80 ? 'text-green-600' : ($complianceScore >= 60 ? 'text-yellow-600' : 'text-red-600') }}"> {{ $complianceScore }}% </p> <p class="text-xs text-gray-500 mt-1"> Documents & approbations </p> </div> <div class="p-3 bg-purple-100 rounded-lg"> <x-iconify icon="solar:shield-check-bold-duotone" class="w-6 h-6 text-purple-600" /> </div> </div> </x-card> @endif </div> {{-- Graphiques Dashboard --}} <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"> {{-- Répartition par catégorie --}} @if($pieChartData) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Répartition par catégorie</h3> <div class="h-64"> <canvas id="categoryPieChart"></canvas> </div> </div> </x-card> @endif {{-- Tendance mensuelle --}} @if($chartData) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Évolution mensuelle</h3> <div class="h-64"> <canvas id="monthlyTrendChart"></canvas> </div> </div> </x-card> @endif </div> {{-- Top véhicules --}} @if($vehicleCosts && count($vehicleCosts) > 0) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Top 10 véhicules par coût</h3> <div class="space-y-3"> @foreach($vehicleCosts as $vehicleCost) <div class="flex items-center justify-between"> <div class="flex items-center gap-3"> <x-iconify icon="solar:car-bold" class="w-5 h-5 text-gray-400" /> <div> <p class="font-medium">{{ $vehicleCost['license_plate'] ?? 'N/A' }}</p> <p class="text-sm text-gray-500">{{ $vehicleCost['brand'] ?? '' }} {{ $vehicleCost['model'] ?? '' }}</p> </div> </div> <div class="text-right"> <p class="font-semibold">{{ number_format($vehicleCost['total_cost'] ?? 0, 2) }} DZD</p> <p class="text-sm text-gray-500">{{ $vehicleCost['expense_count'] ?? 0 }} dépenses</p> </div> </div> @endforeach </div> </div> </x-card> @endif @break @case('tco') {{-- Vue TCO --}} @if($tcoData) <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">TCO Total Flotte</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($tcoData['total_tco'] ?? 0, 2) }} DZD </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">TCO Moyen/Véhicule</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($tcoData['avg_tco'] ?? 0, 2) }} DZD </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Coût/km moyen</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($tcoData['avg_cost_per_km'] ?? 0, 2) }} DZD/km </p> </div> </x-card> </div> {{-- Graphique TCO par véhicule --}} @if($chartLabels && $chartData) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">TCO par véhicule</h3> <div class="h-96"> <canvas id="tcoChart"></canvas> </div> </div> </x-card> @endif @endif @break @case('trends') {{-- Vue Tendances --}} <div class="space-y-6"> {{-- Graphiques de tendances --}} @if($trends) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Tendances des dépenses</h3> <div class="h-96"> <canvas id="trendsChart"></canvas> </div> </div> </x-card> @endif {{-- Prédictions --}} @if($predictions) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Prédictions (3 prochains mois)</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> @foreach($predictions['monthly'] ?? [] as $month => $prediction) <div class="border rounded-lg p-4"> <p class="text-sm text-gray-600">{{ $month }}</p> <p class="text-xl font-bold">{{ number_format($prediction['amount'] ?? 0, 2) }} DZD</p> <p class="text-sm text-gray-500">± {{ number_format($prediction['confidence'] ?? 0, 0) }}%</p> </div> @endforeach </div> </div> </x-card> @endif </div> @break @case('suppliers') {{-- Vue Fournisseurs --}} @if($supplierAnalysis) <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"> {{-- Top fournisseurs --}} <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Top fournisseurs</h3> @if(isset($supplierAnalysis['top_suppliers'])) <div class="space-y-3"> @foreach($supplierAnalysis['top_suppliers'] as $supplier) <div class="flex items-center justify-between"> <div> <p class="font-medium">{{ $supplier['name'] ?? 'N/A' }}</p> <p class="text-sm text-gray-500">{{ $supplier['expense_count'] ?? 0 }} factures</p> </div> <div class="text-right"> <p class="font-semibold">{{ number_format($supplier['total_amount'] ?? 0, 2) }} DZD</p> <p class="text-sm {{ ($supplier['payment_delay'] ?? 0) > 30 ? 'text-red-500' : 'text-green-500' }}"> Délai: {{ $supplier['payment_delay'] ?? 0 }}j </p> </div> </div> @endforeach </div> @endif </div> </x-card> {{-- Graphique fournisseurs --}} @if($chartLabels && $chartData) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Répartition par fournisseur</h3> <div class="h-64"> <canvas id="supplierChart"></canvas> </div> </div> </x-card> @endif </div> @endif @break @case('budgets') {{-- Vue Budgets --}} @if($budgetAnalysis) <div class="space-y-6"> {{-- Vue d'ensemble des budgets --}} <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Budget total alloué</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($budgetAnalysis['total_allocated'] ?? 0, 2) }} DZD </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Budget utilisé</p> <p class="text-2xl font-bold text-gray-900"> {{ number_format($budgetAnalysis['total_used'] ?? 0, 2) }} DZD </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Budget restant</p> <p class="text-2xl font-bold {{ ($budgetAnalysis['total_remaining'] ?? 0) < 0 ? 'text-red-600' : 'text-green-600' }}"> {{ number_format($budgetAnalysis['total_remaining'] ?? 0, 2) }} DZD </p> </div> </x-card> </div> {{-- Détails par groupe --}} @if(isset($budgetAnalysis['groups'])) <x-card> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Utilisation des budgets par groupe</h3> <div class="space-y-4"> @foreach($budgetAnalysis['groups'] as $group) <div> <div class="flex items-center justify-between mb-1"> <span class="text-sm font-medium">{{ $group['name'] ?? 'N/A' }}</span> <span class="text-sm text-gray-500"> {{ number_format($group['budget_used'] ?? 0, 0) }} / {{ number_format($group['budget_allocated'] ?? 0, 0) }} DZD </span> </div> <div class="w-full bg-gray-200 rounded-full h-2.5"> <div class="h-2.5 rounded-full {{ ($group['usage_percentage'] ?? 0) > 90 ? 'bg-red-600' : (($group['usage_percentage'] ?? 0) > 75 ? 'bg-yellow-600' : 'bg-green-600') }}" style="width: {{ min(100, $group['usage_percentage'] ?? 0) }}%"></div> </div> <p class="text-xs text-gray-500 mt-1">{{ number_format($group['usage_percentage'] ?? 0, 1) }}% utilisé</p> </div> @endforeach </div> </div> </x-card> @endif </div> @endif @break @endswitch {{-- Métriques avancées --}} <div class="mt-6"> <button wire:click="toggleAdvancedMetrics" class="text-sm text-primary-600 hover:text-primary-700"> {{ $showAdvancedMetrics ? 'Masquer' : 'Afficher' }} les métriques avancées </button> @if($showAdvancedMetrics && $efficiencyMetrics) <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4"> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Efficacité carburant</p> <p class="text-xl font-bold text-gray-900"> {{ number_format($efficiencyMetrics['fuel_efficiency'] ?? 0, 2) }} L/100km </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Coût maintenance/km</p> <p class="text-xl font-bold text-gray-900"> {{ number_format($efficiencyMetrics['maintenance_cost_per_km'] ?? 0, 2) }} DZD </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">Temps arrêt moyen</p> <p class="text-xl font-bold text-gray-900"> {{ number_format($efficiencyMetrics['avg_downtime'] ?? 0, 1) }} jours </p> </div> </x-card> <x-card class="p-4"> <div> <p class="text-sm font-medium text-gray-600">ROI maintenance</p> <p class="text-xl font-bold {{ ($efficiencyMetrics['maintenance_roi'] ?? 0) > 0 ? 'text-green-600' : 'text-red-600' }}"> {{ number_format($efficiencyMetrics['maintenance_roi'] ?? 0, 1) }}% </p> </div> </x-card> </div> @endif </div>
</div> @push('scripts')
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script> document.addEventListener('DOMContentLoaded', function() { @if($pieChartData) // Graphique camembert catégories new Chart(document.getElementById('categoryPieChart'), { type: 'pie', data: @json($pieChartData), options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', } } } }); @endif @if($chartData && isset($chartData['datasets'])) // Graphique tendances new Chart(document.getElementById('monthlyTrendChart'), { type: 'line', data: { labels: @json($chartLabels), datasets: @json($chartData['datasets']) }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false, }, } } } }); @endif });
</script>
@endpush