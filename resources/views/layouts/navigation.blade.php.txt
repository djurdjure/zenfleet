<nav class="flex flex-col h-full p-4">
    <div class="flex items-center justify-center h-16 border-b border-gray-200 shrink-0 mb-6">
        <a href="{{ route('dashboard') }}">
            <x-application-logo class="block h-10 w-auto" />
        </a>
    </div>

    <div class="flex-grow overflow-y-auto">
        @php
            $isDashboard = request()->routeIs('dashboard');
            $isVehicles = request()->routeIs('admin.vehicles.*');
            $isDrivers = request()->routeIs('admin.drivers.*');
            $isAssignments = request()->routeIs('admin.assignments.*');
            $isMaintenance = request()->routeIs('admin.maintenance.*');
            $isOrganizations = request()->routeIs('admin.organizations.*');
            $isUsers = request()->routeIs('admin.users.*');
            $isRoles = request()->routeIs('admin.roles.*');
        @endphp
        
        <div class="space-y-1">
            <a href="{{ route('dashboard') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isDashboard, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isDashboard])>
                <x-dynamic-component :component="$isDashboard ? 'heroicon-s-home' : 'heroicon-o-home'" class="mr-6 h-6 w-6 shrink-0" />
                <span>{{ __('Dashboard') }}</span>
            </a>
            @can('view vehicles')
                <a href="{{ route('admin.vehicles.index') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isVehicles, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isVehicles])>
                    <x-dynamic-component :component="$isVehicles ? 'heroicon-s-truck' : 'heroicon-o-truck'" class="mr-6 h-6 w-6 shrink-0" />
                    <span>{{ __('Véhicules') }}</span>
                </a>
            @endcan
            @can('view drivers')
                <a href="{{ route('admin.drivers.index') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isDrivers, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isDrivers])>
                    <x-dynamic-component :component="$isDrivers ? 'heroicon-s-user-group' : 'heroicon-o-user-group'" class="mr-6 h-6 w-6 shrink-0" />
                    <span>{{ __('Chauffeurs') }}</span>
                </a>
            @endcan
            @can('view assignments')
                <a href="{{ route('admin.assignments.index') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isAssignments, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isAssignments])>
                    <x-dynamic-component :component="$isAssignments ? 'heroicon-s-clipboard-document-list' : 'heroicon-o-clipboard-document-list'" class="mr-6 h-6 w-6 shrink-0" />
                    <span>{{ __('Affectations') }}</span>
                </a>
            @endcan
            
            @canany(['view maintenance plans', 'view maintenance logs'])
                <div x-data="{ open: @json($isMaintenance) }" class="pt-2">
                    <button @click="open = !open" @class(['group w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isMaintenance, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isMaintenance])>
                        <x-dynamic-component :component="$isMaintenance ? 'heroicon-s-wrench-screwdriver' : 'heroicon-o-wrench-screwdriver'" class="mr-6 h-6 w-6 shrink-0" />
                        <span>{{ __('Maintenance') }}</span>
                        <x-heroicon-s-chevron-down class="ml-auto h-5 w-5 transform transition-transform duration-200" x-bind:class="{ 'rotate-180': open }" />
                    </button>
                    <div x-show="open" x-transition class="pl-8 space-y-1 mt-1">
                        <a href="{{ route('admin.maintenance.dashboard') }}" class="block px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900">{{ __('Dashboard') }}</a>
                        <a href="{{ route('admin.maintenance.plans.index') }}" class="block px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900">{{ __('Plans de Maintenance') }}</a>
                    </div>
                </div>
            @endcanany
        </div>
    </div>

    <div class="shrink-0 border-t border-gray-200 pt-4">
        @role('Super Admin')
            <div class="space-y-1">
                <h6 class="px-3 text-xs text-gray-500 uppercase font-semibold tracking-wider">Administration</h6>
                <a href="{{ route('admin.organizations.index') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isOrganizations, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isOrganizations])>
                    <x-dynamic-component :component="$isOrganizations ? 'heroicon-s-building-office-2' : 'heroicon-o-building-office-2'" class="mr-6 h-6 w-6 shrink-0" />
                    <span>{{ __("Organisations") }}</span>
                </a>
                @can('view users')
                    <a href="{{ route('admin.users.index') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isUsers, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isUsers])>
                        <x-dynamic-component :component="$isUsers ? 'heroicon-s-users' : 'heroicon-o-users'" class="mr-6 h-6 w-6 shrink-0" />
                        <span>{{ __(' Utilisateurs') }}</span>
                    </a>
                @endcan
                <a href="{{ route('admin.roles.index') }}" @class(['group flex items-center px-3 py-2 text-sm font-medium rounded-lg', 'bg-primary-100 text-primary-700' => $isRoles, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' => !$isRoles])>
                    <x-dynamic-component :component="$isRoles ? 'heroicon-s-finger-print' : 'heroicon-o-finger-print'" class="mr-6 h-6 w-6 shrink-0" />
                    <span>{{ __(" Rôles & Permissions") }}</span>
                </a>
            </div>
        @endrole
        
        <div class="mt-4 space-y-1">
            <a href="{{ route('profile.edit') }}" class="group w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                <x-heroicon-o-user-circle class="mr-6 h-6 w-6 shrink-0" />
                <span>{{ Auth::user()->name }}</span>
            </a>
            <form method="POST" action="{{ route('logout') }}">
                @csrf
                <a href="{{ route('logout') }}" onclick="event.preventDefault(); this.closest('form').submit();" class="group w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                    <x-heroicon-o-arrow-left-on-rectangle class="mr-6 h-6 w-6 shrink-0"/>
                    <span>{{ __('Log Out') }}</span>
                </a>
            </form>
        </div>
    </div>
</nav>