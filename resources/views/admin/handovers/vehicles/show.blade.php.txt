<x-app-layout>
    <x-slot name="header">
        <div class="flex justify-between items-center print:hidden">
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                Fiche de Remise N° {{ $handoverForm->id }}
            </h2>
            <div class="space-x-2">
                <a href="{{ route("admin.handovers.vehicles.edit", $handoverForm) }}" class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50">Modifier</a>
                <button onclick="printDiv(\'print-area\')" class="inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700">Imprimer</button>
            </div>
        </div>
    </x-slot>

    <div class="py-12">
        <div id="print-area" class="max-w-4xl mx-auto bg-white shadow-lg border border-gray-300 font-sans text-black">
            
            {{-- En-tête du document --}}
            <div class="text-center mb-4 border-b border-gray-400 pb-3 pt-3">
                <h1 class="text-2xl font-bold uppercase">FICHE DE REMISE VÉHICULE</h1>
                <p class="text-xs mt-1">Référence: FRV-{{ str_pad($handoverForm->id, 6, \'0\', STR_PAD_LEFT) }}</p>
            </div>

            {{-- Informations légales et date --}}
            <div class="px-8 py-2 border-b border-gray-300 text-xs flex justify-between items-center">
                <div>
                    <p class="font-semibold">DOCUMENT CONFIDENTIEL</p>
                    <p class="text-xs text-gray-600">À conserver dans le dossier personnel du conducteur</p>
                </div>
                <div class="text-right">
                   <p class="font-semibold">Date d'émission: {{ now()->format('d/m/Y à H:i') }}</p>                    <p class="text-xs text-gray-600">Valide uniquement avec signatures originales</p>
                </div>
            </div>

            <div class="p-6">
                {{-- Date de remise --}}
                <div class="text-left mb-3">
                    <p class="text-xs">Date de Remise: {{ $handoverForm->issue_date->format(\'d/m/Y\') }}</p>
                </div>

                {{-- Informations Conducteur et Véhicule --}}
                <div class="grid grid-cols-2 gap-6 mb-4 text-xs">
                    <div>
                        <p><strong>Conducteur :</strong> {{ strtoupper($handoverForm->assignment->driver->last_name) }} {{ ucfirst($handoverForm->assignment->driver->first_name) }}</p>
                        <p><strong>Matricule :</strong> {{ $handoverForm->assignment->driver->employee_number ?? \'N/A\' }}</p>
                        <p><strong>Tel :</strong> {{ $handoverForm->assignment->driver->phone_number ?? \'N/A\' }}</p>
                        <p><strong>Motif :</strong> {{ $handoverForm->assignment->reason ?? \'Affectation standard\' }}</p>
                    </div>
                    <div>
                        <p><strong>Véhicule :</strong> {{ $handoverForm->assignment->vehicle->brand }} {{ $handoverForm->assignment->vehicle->model }}</p>
                        <p><strong>Immatriculation :</strong> {{ $handoverForm->assignment->vehicle->registration_plate }}</p>
                        <p><strong>Kilométrage :</strong> {{ number_format($handoverForm->current_mileage, 0, \',\', \' \') }} Km</p>
                    </div>
                </div>

                {{-- État du véhicule et observations --}}
                <div class="mb-4">
                    <div class="flex gap-4">
                        <div class="w-1/3">
                            <h3 class="font-bold mb-1 text-sm">Constat état du véhicule :</h3>
                            <div class="border border-gray-300 p-1 text-center">
                                @if($handoverForm->assignment->vehicle->vehicleType->name === \'Moto\')
                                    <img src="{{ asset(\'images/scooter_sketch.png\') }}" alt="Schéma Scooter" class="w-24 mx-auto">
                                @else
                                    <img src="{{ asset(\'images/car_sketch.png\') }}" alt="Schéma Voiture" class="w-32 mx-auto">
                                @endif
                            </div>
                        </div>
                        <div class="w-2/3">
                            <h3 class="font-bold mb-1 text-sm">Observation :</h3>
                            <div class="border border-gray-300 p-2 min-h-[80px] bg-gray-50">
                                @if($handoverForm->general_observations)
                                    <p class="text-xs">{{ $handoverForm->general_observations }}</p>
                                @else
                                    <p class="text-xs text-gray-500 italic">Aucune observation particulière</p>
                                @endif
                            </div>
                            <p class="text-xs mt-1 italic">* Toute anomalie constatée après signature engage la responsabilité du conducteur.</p>
                        </div>
                    </div>
                </div>

                {{-- Checklist de contrôle --}}
                <div class="mb-6">
                    <h2 class="text-lg font-bold mb-3 text-center">CHECKLIST DE CONTRÔLE</h2>
                    
                    @php
                        $isMoto = $handoverForm->assignment->vehicle->vehicleType->name === \'Moto\';
                    @endphp

                    @if($isMoto)
                        {{-- Checklist pour Moto --}}
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            {{-- Papiers & Accessoires --}}
                            <div>
                                <h3 class="font-bold mb-1 text-center text-sm">Papiers & Accessoires</h3>
                                <table class="w-full text-xs border-collapse border border-gray-300">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-300 p-1 text-left">Elément</th>
                                            <th class="border border-gray-300 p-1 text-center w-12">Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($checklist->get(\'Papiers & Accessoires\', collect()) as $detail)
                                            <tr>
                                                <td class="border border-gray-300 p-1">{{ $detail->item }}</td>
                                                <td class="border border-gray-300 p-1 text-center">{{ $detail->status }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>

                            {{-- État Général --}}
                            <div>
                                <h3 class="font-bold mb-1 text-center text-sm">État Général</h3>
                                <table class="w-full text-xs border-collapse border border-gray-300">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-300 p-1 text-left">Elément</th>
                                            <th class="border border-gray-300 p-1 text-center w-12">Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($checklist->get(\'État Général\', collect()) as $detail)
                                            <tr>
                                                <td class="border border-gray-300 p-1">{{ $detail->item }}</td>
                                                <td class="border border-gray-300 p-1 text-center">{{ $detail->status }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    @else
                        {{-- Checklist pour Voiture --}}
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            {{-- Papiers du véhicule --}}
                            <div>
                                <h3 class="font-bold mb-1 text-center text-sm">Papiers du véhicule</h3>
                                <table class="w-full text-xs border-collapse border border-gray-300">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-300 p-1 text-left">Elément</th>
                                            <th class="border border-gray-300 p-1 text-center w-12">Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($checklist->get(\'Papiers du véhicule\', collect()) as $detail)
                                            <tr>
                                                <td class="border border-gray-300 p-1">{{ $detail->item }}</td>
                                                <td class="border border-gray-300 p-1 text-center">{{ $detail->status }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>

                            {{-- Pneumatiques --}}
                            <div>
                                <h3 class="font-bold mb-1 text-center text-sm">Pneumatiques</h3>
                                <table class="w-full text-xs border-collapse border border-gray-300">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-300 p-1 text-left">Elément</th>
                                            <th class="border border-gray-300 p-1 text-center w-12">Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($checklist->get(\'Pneumatiques\', collect()) as $detail)
                                            <tr>
                                                <td class="border border-gray-300 p-1">{{ $detail->item }}</td>
                                                <td class="border border-gray-300 p-1 text-center">{{ $detail->status }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            {{-- État extérieur --}}
                            <div>
                                <h3 class="font-bold mb-1 text-center text-sm">État extérieur</h3>
                                <table class="w-full text-xs border-collapse border border-gray-300">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-300 p-1 text-left">Elément</th>
                                            <th class="border border-gray-300 p-1 text-center w-12">Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($checklist->get(\'État Extérieur\', collect()) as $detail)
                                            <tr>
                                                <td class="border border-gray-300 p-1">{{ $detail->item }}</td>
                                                <td class="border border-gray-300 p-1 text-center">{{ $detail->status }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>

                            {{-- Accessoires & intérieur --}}
                            <div>
                                <h3 class="font-bold mb-1 text-center text-sm">Accessoires & intérieur</h3>
                                <table class="w-full text-xs border-collapse border border-gray-300">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-300 p-1 text-left">Elément</th>
                                            <th class="border border-gray-300 p-1 text-center w-12">Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($checklist->get(\'Accessoires Intérieur\', collect()) as $detail)
                                            <tr>
                                                <td class="border border-gray-300 p-1">{{ $detail->item }}</td>
                                                <td class="border border-gray-300 p-1 text-center">{{ $detail->status }}</td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    @endif
                </div>

                {{-- Signatures --}}
                <div class="mt-8">
                    <div class="grid grid-cols-3 gap-6 text-center">
                        <div>
                            <div class="border border-gray-400 p-3 bg-gray-50 min-h-[60px] mb-2 flex items-center justify-center">
                                <p class="text-gray-500 italic text-xs">Espace réservé à la signature</p>
                            </div>
                            <div class="border-t border-black pt-2">
                                <p class="font-bold text-xs">RESPONSABLE HIÉRARCHIQUE</p>
                                <p class="text-xs text-gray-600 mt-1">Nom et Fonction</p>
                                <p class="text-xs text-gray-500 mt-1">Date: _______________</p>
                                <p class="text-xs text-gray-500">Cachet de service</p>
                            </div>
                        </div>
                        
                        <div>
                            <div class="border border-gray-400 p-3 bg-gray-50 min-h-[60px] mb-2 flex items-center justify-center">
                                <p class="text-gray-500 italic text-xs">Espace réservé à la signature</p>
                            </div>
                            <div class="border-t border-black pt-2">
                                <p class="font-bold text-xs">CONDUCTEUR DÉSIGNÉ</p>
                                <p class="text-xs text-gray-600 mt-1">{{ strtoupper($handoverForm->assignment->driver->last_name) }} {{ ucfirst($handoverForm->assignment->driver->first_name) }}</p>
                                <p class="text-xs text-gray-500 mt-1">Date: _______________</p>
                                <p class="text-xs text-gray-500">Lu et approuvé</p>
                            </div>
                        </div>

                        <div>
                            <div class="border border-gray-400 p-3 bg-gray-50 min-h-[60px] mb-2 flex items-center justify-center">
                                <p class="text-gray-500 italic text-xs">Espace réservé à la signature</p>
                            </div>
                            <div class="border-t border-black pt-2">
                                <p class="font-bold text-xs">RESPONSABLE DU PARC</p>
                                <p class="text-xs text-gray-600 mt-1">Nom et Fonction</p>
                                <p class="text-xs text-gray-500 mt-1">Date: _______________</p>
                                <p class="text-xs text-gray-500">Cachet de service</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto mt-6 print:hidden">
            {{-- Section de téléversement pour les signatures scannées --}}
            <div class="bg-white shadow-lg rounded-lg p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Téléversement des Signatures Scannées</h3>
                <p class="text-sm text-gray-600 mb-4">Une fois le document signé physiquement, vous pouvez téléverser une version scannée pour archivage numérique.</p>
                <div class="flex items-center justify-center w-full">
                    <label for="dropzone-file" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                            </svg>
                            <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Cliquez pour téléverser</span> ou glissez-déposez</p>
                            <p class="text-xs text-gray-500">PDF, PNG, JPG (MAX. 10MB)</p>
                        </div>
                        <input id="dropzone-file" type="file" class="hidden" accept=".pdf,.png,.jpg,.jpeg" />
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        function printDiv(divId) {
            var printContents = document.getElementById(divId).innerHTML;
            var originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;

            window.print();

            document.body.innerHTML = originalContents;
        }
    </script>

    <style>
        @media print {
            body, .x-app-layout-body { 
                background-color: white !important; 
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            .print\:hidden { display: none !important; }
            #print-area { 
                box-shadow: none; 
                border: none; 
                max-width: none;
                margin: 0;
                padding: 0;
            }
            .print\:break-before-page { 
                break-before: page; 
                page-break-before: always;
            }
            /* Assurer que les bordures restent noires */
            .border, .border-b, .border-t, .border-l, .border-r, .border-2, .border-b-2, .border-t-2, .border-gray-300, .border-gray-400, .border-black {
                border-color: black !important;
            }
            /* Assurer que les textes restent noirs */
            .text-gray-700, .text-gray-600, .text-gray-800, .text-gray-500 {
                color: black !important;
            }
            /* Supprimer les couleurs de fond */
            .bg-gray-50, .bg-gray-100 {
                background-color: transparent !important;
            }
        }
        
        @page {
            margin: 1cm;
            size: A4;
        }
    </style>
</x-app-layout>

