var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,g,p){if(f==Array.prototype||f==Object.prototype)return f;f[g]=p.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var g=0;g<f.length;++g){var p=f[g];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,g){var p=$jscomp.propertyToPolyfillSymbol[g];if(null==p)return f[g];p=f[p];return void 0!==p?p:f[g]};$jscomp.polyfill=function(f,g,p,q){g&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,g,p,q):$jscomp.polyfillUnisolated(f,g,p,q))};
$jscomp.polyfillUnisolated=function(f,g,p,q){p=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var t=f[q];if(!(t in p))return;p=p[t]}f=f[f.length-1];q=p[f];g=g(q);g!=q&&null!=g&&$jscomp.defineProperty(p,f,{configurable:!0,writable:!0,value:g})};
$jscomp.polyfillIsolated=function(f,g,p,q){var t=f.split(".");f=1===t.length;q=t[0];q=!f&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var D=0;D<t.length-1;D++){var G=t[D];if(!(G in q))return;q=q[G]}t=t[t.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[t]:null;g=g(p);null!=g&&(f?$jscomp.defineProperty($jscomp.polyfills,t,{configurable:!0,writable:!0,value:g}):g!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[t]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[t]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(t):$jscomp.POLYFILL_PREFIX+p+"$"+t),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[t],{configurable:!0,writable:!0,value:g})))};$jscomp.underscoreProtoCanBeSet=function(){var f={a:!0},g={};try{return g.__proto__=f,g.a}catch(p){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(f,g){f.__proto__=g;if(f.__proto__!==g)throw new TypeError(f+" is not extensible");return f}:null;$jscomp.arrayIteratorImpl=function(f){var g=0;return function(){return g<f.length?{done:!1,value:f[g++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};
$jscomp.makeIterator=function(f){var g="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return g?g.call(f):$jscomp.arrayIterator(f)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(f){if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(f){this.yieldResult=f};$jscomp.generator.Context.prototype.throw_=function(f){this.abruptCompletion_={exception:f,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(f){this.abruptCompletion_={return:f};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(f){this.abruptCompletion_={jumpTo:f};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(f,g){this.nextAddress=g;return{value:f}};$jscomp.generator.Context.prototype.yieldAll=function(f,g){f=$jscomp.makeIterator(f);var p=f.next();$jscomp.generator.ensureIteratorResultIsObject_(p);if(p.done)this.yieldResult=p.value,this.nextAddress=g;else return this.yieldAllIterator_=f,this.yield(p.value,g)};
$jscomp.generator.Context.prototype.jumpTo=function(f){this.nextAddress=f};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(f,g){this.catchAddress_=f;void 0!=g&&(this.finallyAddress_=g)};$jscomp.generator.Context.prototype.setFinallyBlock=function(f){this.catchAddress_=0;this.finallyAddress_=f||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(f,g){this.nextAddress=f;this.catchAddress_=g||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(f){this.catchAddress_=f||0;f=this.abruptCompletion_.exception;this.abruptCompletion_=null;return f};$jscomp.generator.Context.prototype.enterFinallyBlock=function(f,g,p){p?this.finallyContexts_[p]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=f||0;this.finallyAddress_=g||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(f,g){g=this.finallyContexts_.splice(g||0)[0];if(g=this.abruptCompletion_=this.abruptCompletion_||g){if(g.isException)return this.jumpToErrorHandler_();void 0!=g.jumpTo&&this.finallyAddress_<g.jumpTo?(this.nextAddress=g.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=f};$jscomp.generator.Context.prototype.forIn=function(f){return new $jscomp.generator.Context.PropertyIterator(f)};
$jscomp.generator.Context.PropertyIterator=function(f){this.object_=f;this.properties_=[];for(var g in f)this.properties_.push(g);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var f=this.properties_.pop();if(f in this.object_)return f}return null};$jscomp.generator.Engine_=function(f){this.context_=new $jscomp.generator.Context;this.program_=f};
$jscomp.generator.Engine_.prototype.next_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,f,this.context_.next_);this.context_.next_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(f){this.context_.start_();var g=this.context_.yieldAllIterator_;if(g)return this.yieldAllStep_("return"in g?g["return"]:function(p){return{value:p,done:!0}},f,this.context_.return);this.context_.return(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],f,this.context_.next_);this.context_.throw_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(f,g,p){try{var q=f.call(this.context_.yieldAllIterator_,g);$jscomp.generator.ensureIteratorResultIsObject_(q);if(!q.done)return this.context_.stop_(),q;var t=q.value}catch(D){return this.context_.yieldAllIterator_=null,this.context_.throw_(D),this.nextStep_()}this.context_.yieldAllIterator_=null;p.call(this.context_,t);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var f=this.program_(this.context_);if(f)return this.context_.stop_(),{value:f.value,done:!1}}catch(g){this.context_.yieldResult=void 0,this.context_.throw_(g)}this.context_.stop_();if(this.context_.abruptCompletion_){f=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(f.isException)throw f.exception;return{value:f.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(f){this.next=function(g){return f.next_(g)};this.throw=function(g){return f.throw_(g)};this.return=function(g){return f.return_(g)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(f,g){g=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(g));$jscomp.setPrototypeOf&&f.prototype&&$jscomp.setPrototypeOf(g,f.prototype);return g};
$jscomp.asyncExecutePromiseGenerator=function(f){function g(q){return f.next(q)}function p(q){return f.throw(q)}return new Promise(function(q,t){function D(G){G.done?q(G.value):Promise.resolve(G.value).then(g,p).then(D,t)}D(f.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(f){return $jscomp.asyncExecutePromiseGenerator(f())};$jscomp.asyncExecutePromiseGeneratorProgram=function(f){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(f)))};
(()=>{function f(a){try{var b=new URL(a);return!!b&&"https:"===b.protocol}catch(c){return!1}}function g(a=!1){return embeddedservice_bootstrap.isLocalStorageAvailable&&a?localStorage:embeddedservice_bootstrap.isSessionStorageAvailable?sessionStorage:void 0}function p(){let a,b;const c=JSON.stringify({});embeddedservice_bootstrap.isLocalStorageAvailable&&!localStorage.getItem(u)&&(a=c,localStorage.setItem(u,a));embeddedservice_bootstrap.isSessionStorageAvailable&&!sessionStorage.getItem(u)&&(b=c,sessionStorage.setItem(u,
b));(a||b)&&U("ESW_3RDPARTY_STORAGE_SET_OBJECTS",{orgId:embeddedservice_bootstrap.settings.orgId,localStorageObj:a,sessionStorageObj:b});n("initializeWebStorage","web storage initialized")}function q(a,b=!0){let c;(b=g(b))&&(c=(b.getItem(u)&&JSON.parse(b.getItem(u))||{})[a]);return c}function t(a,b){if(b&&a){const c=b.getItem(u)&&JSON.parse(b.getItem(u))||{};Object.keys(a).forEach(d=>{c[d]=a[d]});0!==Object.keys(c).length&&b.setItem(u,JSON.stringify(c))}}function D(a,b,c=!0,d=!1){const e=g(c);if(e){const h=
e.getItem(u)&&JSON.parse(e.getItem(u))||{};h[a]=b;e.setItem(u,JSON.stringify(h));n("setItemInWebStorage",`${a} set in ${c?"localStorage":"sessionStorage"}`);d&&U("ESW_3RDPARTY_STORAGE_SET_ITEMS",{orgId:embeddedservice_bootstrap.settings.orgId,key:a,value:b,inLocalStorage:c})}}function G(a){embeddedservice_bootstrap.isLocalStorageAvailable&&!a&&localStorage.removeItem(u);embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.removeItem(u);U("ESW_3RDPARTY_STORAGE_CLEAR",embeddedservice_bootstrap.settings.orgId);
n("clearWebStorage","web storage cleared")}function qb(){F=void 0;sa=new Promise(b=>{ta=b});K={};V={};J=void 0;N=H=!1;Ia();Ja();rb();n("clearInMemoryData","Cleared in-memory data.");const a=Ka();n("clearInMemoryData",`Reset conversationId. Old conversationId: ${E} & New conversationId: ${a}`);E=a}function La(a){const b=(c,d)=>{Object.keys(d).forEach(e=>{"object"===typeof c[e]&&typeof("object"===d[e])?b(c[e],d[e]):void 0===c[e]&&(c[e]=d[e])})};a&&"object"===typeof a&&b(embeddedservice_bootstrap.settings,
a)}function W(a,b,c){if((c||embeddedservice_bootstrap.settings.devMode)&&console&&console[a])console[a]("[EmbeddedServiceBootstrap] "+(Array.isArray(b)?b.join(", "):b))}function n(a,b,c){W("log",b,c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:E,convType:y(),hostUrl:window.location.href});ua(c)}function r(a,b){a?W("warn","Warning: "+a,b):W("warn","EmbeddedServiceBootstrap sent an anonymous warning.",
b)}function m(a,b,c,d){b?W("error",b,d):W("error","EmbeddedServiceBootstrap responded with an unspecified error.",d);d={};Object.assign(d,Object.assign({},{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",errMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:""},c&&{errCode:c},{convId:E,convType:y(),hostUrl:window.location.href}));ua(null,d)}function va(){return window.$A&&"function"===typeof window.$A.get&&window.$A.get("$Site")}function Ka(){const a=new Uint32Array(32);
crypto.getRandomValues(a);let b="";for(let c=0;32>c;c++){if(8===c||12===c||16===c||20===c)b+="-";b=12===c?b+"4":16===c?b+"0123456789abcdef".charAt(a[c]&3|8):b+"0123456789abcdef".charAt(a[c]&15)}return b}function wa(a,b,c){const d=document.createElementNS("http://www.w3.org/2000/svg",b);Object.getOwnPropertyNames(c).forEach(e=>{"children"===e?c.children.forEach(h=>{wa(d,h.type,h)}):d.setAttribute(e,c[e])});a.appendChild(document.createTextNode("\n"));a.appendChild(d);a.appendChild(document.createTextNode("\n"))}
function xa(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg");if(a)return b.setAttribute("focusable","false"),b.setAttribute("aria-hidden","true"),b.setAttribute("viewBox","0 0 100 100"),Array.isArray(a)?a.forEach(c=>{wa(b,c.type,c)}):wa(b,"path",{d:a}),b;m("renderSVG","Invalid icon data.")}function sb(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},
{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout fetch".split(" ")}].forEach(a=>{a.functions.forEach(b=>{b in a.object&&!Function.prototype.toString.call(a.object[b]).match(/\[native code\]/)&&r("EmbeddedService Messaging Bootstrap may not function correctly with this native JS function modified: "+a.name+"."+b,!0)})})}function ka(a){"string"!==typeof a?m("setAndStoreJwt",`Expected to receive string, instead received: ${a}.`):
(F=a,D(z.JWT,F))}function tb(){window.addEventListener("message",Ma);embeddedservice_bootstrap.isLocalStorageAvailable&&window.addEventListener("storage",Na);try{(new PerformanceObserver(a=>{a.getEntries().forEach(b=>{"reload"===b.type&&v("EMBEDDED_MESSAGING_APP_AFTER_REFRESH")})})).observe({type:"navigation",buffered:!0})}catch(a){m("addEventHandlers",`Unable to initialize PerformanceObserver ${a}.`)}}function Ma(a){if(a&&a.data&&a.origin)if(embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.contentWindow===
a.source)switch(a.data.method){case "ESW_APP_SHOW_FILE_PREVIEW_FRAME":Oa(!0);break;case "ESW_APP_HIDE_FILE_PREVIEW_FRAME":Oa(!1);break;default:r("Unrecognized event name: "+a.data.method)}else if(embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.contentWindow===a.source)switch(a.data.method){case "ESW_3RDPARTY_STORAGE_READY":Pa();break;case "ESW_3RDPARTY_STORAGE_RESPONSE":a.data.data&&a.data.data.localStorage&&t(a.data.data.localStorage,localStorage);a.data.data&&
a.data.data.sessionStorage&&t(a.data.data.sessionStorage,sessionStorage);Qa();break;default:r("Unrecognized event name: "+a.data.method)}else if(0===I().indexOf(a.origin)&&embeddedservice_bootstrap.isMessageFromSalesforceDomain(a.origin)&&A().contentWindow===a.source){var b=A();switch(a.data.method){case "ESW_APP_READY_EVENT":ta();break;case "ESW_APP_LOADED":a=w();b=document.getElementById("embeddedMessagingIconContainer");let c=document.getElementById("embeddedMessagingIconChat"),d=document.getElementById("embeddedMessagingLoadingSpinner");
A()||r("Embedded Messaging iframe not available for post-app-load updates.");a?(b&&d&&b.removeChild(d),c&&(c.style.display="none"),a.disabled=!1,a.classList.remove("embeddedMessagingConversationButtonLoading"),a.classList.add("embeddedMessagingConversationButtonLoaded"),a.classList.add("no-hover")):r("Embedded Messaging static button not available for post-app-load updates.");Ra();N=!0;try{L("onEmbeddedMessagingInitSuccess")}catch(e){N=!1,m("emitEmbeddedMessagingInitSuccessEvent",`Something went wrong in firing onEmbeddedMessagingInitSuccess event ${e}.`)}break;
case "ESW_APP_INITIALIZATION_ERROR":X();break;case "ESW_APP_MINIMIZE":embeddedservice_bootstrap.minimizeIframe(b,a.data.data);break;case "ESW_APP_MAXIMIZE":embeddedservice_bootstrap.maximizeIframe(b);break;case "ESW_APP_RESET_INITIAL_STATE":Q();break;case "ESW_SET_JWT_EVENT":ka(a.data.data);break;case "ESW_CLEAR_WEBSTORAGE_EVENT":G();break;case "ESW_DOWNLOAD_FILE":ub(a.data.data);break;case "ESW_SET_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=a.data.data;"object"!==typeof a?m("storeFailedMessagesInWebStorage",
`Expected to receive object, instead received: ${a}.`):D(z.FAILED_OUTBOUND_MESSAGE_ENTRIES,a,!1);break;case "ESW_CLEAN_UP_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=z.FAILED_OUTBOUND_MESSAGE_ENTRIES;embeddedservice_bootstrap.isLocalStorageAvailable&&localStorage.getItem(u)&&(b=JSON.parse(localStorage.getItem(u))||{},delete b[a],localStorage.setItem(u,JSON.stringify(b)));embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.getItem(u)&&(b=JSON.parse(sessionStorage.getItem(u))||{},delete b[a],
sessionStorage.setItem(u,JSON.stringify(b)));n("removeItemInWebStorage",`${a} removed from web storage`);break;case "ESW_APP_UPDATE_TITLE_NOTIFICATION":Ia(a.data.data);break;case "ESW_APP_SEND_HIDDEN_PRECHAT_FIELDS":v("ESW_APP_RECEIVE_HIDDEN_PRECHAT_FIELDS",K);break;case "ESW_APP_SEND_AUTORESPONSE_PARAMETERS":v("ESW_APP_RECEIVE_AUTORESPONSE_PARAMETERS",V);break;case "EMBEDDED_MESSAGING_IDENTITY_TOKEN_EXPIRED_EVENT":y()!==B.AUTH?r("handleIdentityTokenExpiredEvent method called but User Verification isn\u2019t enabled in Messaging Settings."):
L("onEmbeddedMessagingIdentityTokenExpired");break;case "EMBEDDED_MESSAGING_JWT_RETRIEVAL_FAILURE_EVENT":Sa();break;case "ESW_APP_PRECHAT_SUBMIT":vb(a.data.data);break;case "ESW_APP_SHOW_MINIMIZED_STATE_NOTIFICATION":(a=A())&&a.classList.add("hasMinimizedNotification");break;case "EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_EVENT":wb();break;default:r("Unrecognized event name: "+a.data.method)}}else m("handleMessageEvent",`Unexpected message origin: ${a.origin}`)}function Na(a){a&&a.key&&a.key===u&&null===
a.newValue&&y()===B.AUTH&&ya(!1,!0)}function X(){N=!0;try{ua(),L("onEmbeddedMessagingInitError")}catch(a){N=!1,m("emitEmbeddedMessagingInitErrorEvent",`Something went wrong in firing onEmbeddedMessagingInitError event ${a}.`)}}function L(a){if(!a)throw Error(`Expected an eventName parameter with a string value. Instead received ${a}.`);try{window.dispatchEvent(new CustomEvent(a))}catch(b){throw Error("Something went wrong while dispatching the event "+a+":"+b);}}function Ia(a){if(a){const b=JSON.parse(a)[0],
c=Ta;Y&&window.clearInterval(Y);Y=window.setInterval(()=>{document.title=document.title===b?c:b},1E3)}else window.clearInterval(Y),Y=void 0,document.title=Ta}function A(){return document.getElementById("embeddedMessagingFrame")}function w(){return document.getElementById("embeddedMessagingConversationButton")}function Oa(a){const b=A();embeddedservice_bootstrap.filePreviewFrame&&b&&(a?(embeddedservice_bootstrap.filePreviewFrame.classList.add("show"),embeddedservice_bootstrap.filePreviewFrame.contentWindow.focus(),
embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","false"),b.tabIndex="-1",b.setAttribute("aria-hidden","true")):(embeddedservice_bootstrap.filePreviewFrame.classList.remove("show"),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","true"),b.tabIndex="0",b.setAttribute("aria-hidden","false")),n("setFilePreviewFrameVisibility",`Full size file preview ${a?"shown":"hidden"}`))}function ub(a){let b;if(!f(a.attachmentDownloadURL))throw Error(`Invalid attachmentDownloadURL : ${a.attachmentDownloadURL}.`);
b=document.createElement("iframe");b.style.display="none";b.src=a.attachmentDownloadURL||"";document.body.appendChild(b);a.shouldOpenFileInNewTab&&window.open(b.src,"_blank","noreferrer noopener");setTimeout(()=>{document.body.removeChild(b)},1E3)}function Ua(a){return new Promise((b,c)=>{let d=I(),e=document.createElement("link");e.id="embeddedMessagingBootstrapStyles";e.class="embeddedMessagingBootstrapStyles";e.href=d+"/assets/styles/bootstrap"+(embeddedservice_bootstrap.settings.devMode?"":".min")+
".css";e.type="text/css";e.rel="stylesheet";e.onerror=c;e.onload=b;document.getElementsByTagName("head")[0].appendChild(e)})}function Va(){return Wa(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/embedded-service-config?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName+"&language="+embeddedservice_bootstrap.settings.language,"GET","getConfigurationData")}function za(){return Wa(embeddedservice_bootstrap.settings.scrt2URL+
"/embeddedservice/v1/businesshours?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,"GET","getBusinessHoursInterval").then(a=>{a=a&&a.businessHoursInfo;n("getBusinessHoursInterval","Successfully retrieved Business Hours data");a&&Array.isArray(a.businessHours)&&0<a.businessHours.length&&(Z()||"boolean"!==typeof embeddedservice_bootstrap.settings.hideChatButtonOnLoad)&&(M={startTime:a.businessHours[0].startTime,endTime:a.businessHours[0].endTime},
Aa())}).catch(a=>{throw a;})}function Xa(a){m("handleBusinessHoursError","Failed to retrieve Business Hours data. Retrying the request.",a);return za()}function Wa(a,b,c){const d=performance.now();return new Promise((e,h)=>{const l=new XMLHttpRequest;l.open(b,a,!0);l.onreadystatechange=k=>{if((k=k.target)&&k.readyState===k.DONE||204===k.status){const O=((performance.now()-d)/1E3).toFixed(3);if(200===k.status||204===k.status){const P=k.responseText?JSON.parse(k.responseText):k.responseText;e(P)}else h(k.status);
n("sendXhrRequest",`${c?c:a} took ${O} seconds and returned with the status code ${k.status}`)}};l.send()})}function xb(){return y()===B.AUTH?Ya().then(a=>la().then(b=>{n("initializeConversationState","finished joining verified user conversation");ma(a,b)}).catch(()=>{X()})):y()===B.UNAUTH?Za()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?(ma(),Promise.resolve()):Ba().then(a=>aa(K).then(b=>{n("initializeConversationState","finished creating conversation");
ma(a,b)}).catch(()=>{X()})):Promise.reject(Error("Something went wrong initializing conversation state."))}function ma(a,b,c=!1){var d=q(z.FAILED_OUTBOUND_MESSAGE_ENTRIES,!1);const e=embeddedservice_bootstrap.settings.standardLabels,h=embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels;if(embeddedservice_bootstrap.settings.imageCompressionOptions){var l=embeddedservice_bootstrap.settings.imageCompressionOptions;l=Object.assign({},l.quality&&!isNaN(Number(l.quality))&&0<=Number(l.quality)&&
1>=Number(l.quality)&&{quality:Number(l.quality)},l.maxHeight&&!isNaN(Number(l.maxHeight))&&0<Number(l.maxHeight)&&{maxHeight:Number(l.maxHeight)},l.maxWidth&&!isNaN(Number(l.maxWidth))&&0<Number(l.maxWidth)&&{maxWidth:Number(l.maxWidth)},l.convertTypes&&("string"===typeof l.convertTypes||Array.isArray(l.convertTypes))&&{convertTypes:l.convertTypes},l.convertSize&&!isNaN(Number(l.convertSize))&&0<=Number(l.convertSize)&&{convertSize:l.convertSize})}l=Object.assign({},l&&{imageCompressionOptions:l},
"boolean"===typeof embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot&&{enableUserInputForConversationWithBot:!!embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot},"boolean"===typeof embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist&&{shouldShowParticipantChgEvntInConvHist:!!embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist},{shouldMinimizeWindowOnNewTab:embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab});
d=Object.assign({},embeddedservice_bootstrap.settings.embeddedServiceConfig,Object.assign({},{identityToken:J,failedMessages:d,conversationId:E,devMode:!!embeddedservice_bootstrap.settings.devMode,language:embeddedservice_bootstrap.settings.language},e&&{standardLabels:e},h&&{customLabels:h},{hasConversationButtonColorContrastMetA11yThreshold:$a.isValidContrastRatio("#FFFFFF",R("headerColor")),hostUrl:window.location.href,snippetSettings:l}))||{};a&&(d=Object.assign(d,{jwtData:a}));b&&(d=Object.assign(d,
{conversationData:b}));d.isExistingSessionOnPageLoad=c;v("ESW_SET_CONFIG_EVENT",d)}function vb(a){const b=Object.assign(a,K);y()===B.AUTH?la().then(c=>{c&&c.isExistingConversation?(n("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the verified user. Joining the existing conversation."),v("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",c)):(n("handlePrechatSubmit","Pre-chat submitted. Creating a new conversation."),aa(b).then(d=>{v("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",
d)}))}):y()===B.UNAUTH&&(q(z.JWT)?(n("handlePrechatSubmit","Pre-chat submitted but a JWT exists in web storage. Fetching existing conversations."),F=q(z.JWT),ab().then(c=>{v("ESW_SET_JWT_EVENT",c);la().then(d=>{d&&d.isExistingConversation?(n("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the unverified user. Joining the existing conversation."),v("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)):(n("handlePrechatSubmit","Pre-chat submitted and no existing conversations found. Creating a new conversation."),
aa(b).then(e=>{v("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",e)}))})})):(n("handlePrechatSubmit","Pre-chat submitted. Fetching a JWT and starting a new conversation."),Ba().then(c=>{v("ESW_SET_JWT_EVENT",c);aa(b).then(d=>{v("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)})})))}function bb(){return new Promise(a=>{embeddedservice_bootstrap.createFilePreviewFrame();embeddedservice_bootstrap.createIframe().then(()=>{a("Created Embedded Messaging frame.")})})}function ab(){return q(z.JWT)?yb().then(a=>
{ka(a.accessToken);n("handleGetContinuityJwt","Sucessfully retreived a Continuity JWT");return a}).catch(a=>{m("handleGetContinuityJwt",`Failed to get Continuity JWT: ${a&&a.message?a.message:a}.`);Q()}):Promise.reject(void 0)}function yb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/continuityAccessToken");return S(a,"GET","cors",null,null,"getContinuityJwt").then(b=>{if(!b.ok)throw b;return b.json()})}function Ba(){return zb().then(a=>{ka(a.accessToken);
n("handleGetUnauthenticatedJwt","Successfully retreived an Unauthenticated JWT");return a}).catch(a=>Ab(a))}function zb(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName;var c=cb();c=c?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken","?",c):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken");return S(c,"POST","cors",{"Content-Type":"application/json"},
{orgId:a,developerName:b,capabilitiesVersion:"248"},"getUnauthenticatedJwt").then(d=>{if(!d.ok)throw d;return d.json()})}function Ya(){return Bb().then(a=>{ka(a.accessToken);n("handleGetAuthenticatedJwt","Successfully retreived an Authenticated JWT");return a}).catch(a=>{m("handleGetAuthenticatedJwt",`Error retrieving authenticated token: ${a&&a.message?a.message:a}.`);Sa()})}function Bb(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName,c=J,d=
cb(),e=d?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken","?",d):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken"),h={"Content-Type":"application/json"},l={orgId:a,developerName:b,capabilitiesVersion:"248",authorizationType:Ca.JWT,customerIdentityToken:c};return c&&na(c)?ba(e,"POST","cors",h,l,"getAuthenticatedJwt").then(k=>{if(!k.ok)throw k;return k.json()}).catch(k=>oa(k,e,"POST",
"cors",h,l,"getAuthenticatedJwt")):(new Promise(k=>{db({apiPath:e,method:"POST",mode:"cors",requestHeaders:h,requestBody:l,resolve:k})})).then(k=>{if(!k.ok)throw k;return k.json()})}function Cb(){Db().then(()=>{n("handleRegisterDeviceCapabilities","Successfully Registered Device Capabilities.")})}function Db(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/device/registerDeviceCapabilities");return S(a,"POST","cors",null,{},"registerDeviceCapabilities")}function la(a){return Eb(!1,
embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier:null).then(b=>{let c=[];if(!b.conversations||!Array.isArray(b.conversations))throw Error(`Invalid conversation list: ${b.conversations}.`);c=b.conversations.filter(d=>0===d.endTimestamp);if(0===c.length){if(a)throw n("handleListConversation","No open conversation found, deleting stale data from web storage.",!0),r("No open conversation found, deleting stale data from web storage."),
Q(),Error("No open conversation found for JWT in web storage.");return Za()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?null:(n("handleListConversation","No existing conversation found and pre-chat is not enabled. Will start a new conversation."),r("No existing conversation found and pre-chat is not enabled. Will start a new conversation."),aa(K).then(d=>d))}1<c.length&&(n("handleListConversation",`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),
r(`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),c.sort((d,e)=>e.startTimestamp-d.startTimestamp));b=c[0];if(!Fb(b.conversationId))throw Error(`Invalid conversation identifier: ${b.conversationId}.`);n("handleListConversation","Successfully retrieved existing conversation");E!=b.conversationId&&(n("handleListConversation",`ConversationId change detected. Old conversation-id: ${E} & New conversation-id: ${b.conversationId}`),
E=b.conversationId);b.isExistingConversation=!0;return b}).catch(b=>{m("handleListConversation",`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);throw Error(`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);})}function Eb(a,b){const c=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/queries/conversation/list");return S(c,"POST","cors",null,Object.assign({},{includeClosedConversations:a},b&&{channelAddressIdentifier:b}),"listConversation").then(d=>
d.json())}function Ab(a){if(a&&a.status&&401===a.status)return m("handleGetJwtError","Unauthorized error caused by JWT expiration. Attempt to get another JWT",a.status),Ba().catch(b=>{throw Error(b);});throw Error(`Error retrieving unauthenticated token: ${a}.`);}function Za(){return(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms||[]).some(a=>{a.formFields=a.formFields||[];return"PreChat"===a.formType&&0<a.formFields.length})}function aa(a){return Gb(a).then(b=>{Cb();b.esDeveloperName=
embeddedservice_bootstrap.settings.eswConfigDevName;n("handleCreateNewConversation",`Initialized the esDeveloperName associated with current conversation to: ${embeddedservice_bootstrap.settings.eswConfigDevName}`);return b})}function Gb(a){const b=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation");return S(b,"POST","cors",null,Object.assign({},a&&{routingAttributes:a},{conversationId:E}),"createNewConversation").then(c=>c.json())}function Hb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation",
"/",E,"/transcript");return S(a,"GET","cors",null,null,"getTranscript").then(b=>b.arrayBuffer())}function wb(){Hb().then(a=>{a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="ConversationTranscript.pdf";b.click();window.URL.revokeObjectURL(a);v("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_SUCCESS_EVENT")}).catch(a=>{if(a){const b=a.status;a=a.message||void 0;v("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{errorCode:b,
errorMessage:a}});m("handleRequestTranscript",`Transcript request failed with status code: ${b} & message: ${a}`,b)}else v("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{}})})}function ba(a,b,c,d,e,h=a){d=d?d:Object.assign({},{"Content-Type":"application/json"},F&&{Authorization:"Bearer "+F});e=e?JSON.stringify(e):void 0;const l=performance.now();return fetch(a,Object.assign({},{method:b,mode:c,headers:d},e&&{body:e})).then(k=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const O=
((performance.now()-l)/1E3).toFixed(3);n("sendFetchRequest",`${h} took ${O} seconds and returned with the status code ${k.status}`);401===k.status&&G();if(!k.ok){let P;try{P=Object.assign(k,yield k.json())}catch(Wb){P=Object.assign(k,{message:`Error reading the body stream of error object: ${k}`})}throw P;}return k}))}function oa(a,b,c,d,e,h,l=b){if(!a||!a.status||500<=a.status&&599>=a.status)return m("handleSendFetchRequestError",`Something went wrong in ${l}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},
a,{status:a.status,statusText:a.statusText,type:a.type}))}. Re-trying the request.`,a&&a.status),ba(b,c,d,e,h,l).catch(k=>{m("handleSendFetchRequestError",`${l} request failed again: ${k&&k.message?k.message:JSON.stringify(Object.assign({},k,{status:k.status,statusText:k.statusText,type:k.type}))}.`,k&&k.status);throw k;});m("handleSendFetchRequestError",`Something went wrong in ${l}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,
a&&a.status);throw a;}function S(a,b,c,d,e,h){return y()===B.AUTH?F&&na(F)?ba(a,b,c,d,e,h).catch(l=>oa(l,a,b,c,d,e,h)):J&&na(J)?new Promise(l=>{eb({apiPath:a,method:b,mode:c,requestHeaders:d,requestBody:e,resolve:l})}):new Promise(l=>{db({apiPath:a,method:b,mode:c,requestHeaders:d,requestBody:e,resolve:l})}):ba(a,b,c,d,e,h).catch(l=>oa(l,a,b,c,d,e,h))}function cb(){var a=[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera].join(" ");const b=fb(a,[{name:"Windows Phone",
value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}]);a=fb(a,[{name:"Edge",
value:"Edg",version:"Edg"},{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}]);return(new URLSearchParams({os:b.name,osVersion:b.version,browser:a.name,browserVersion:a.version})).toString()}function fb(a,
b){let c;let d;for(c=0;c<b.length;c+=1){var e=new RegExp(b[c].value,"i");if(e=e.test(a)){e=new RegExp(b[c].version+"[- /:;]([\\d._]+)","i");e=a.match(e);d="";e&&e[1]&&(e=e[1]);if(e)for(e=e.split(/[._]+/),a=0;a<e.length;a+=1)d=0===a?d+(e[a]+"."):d+e[a];else d="0";return{name:b[c].name,version:parseFloat(d)}}}return{name:"unknown",version:0}}function I(){try{return embeddedservice_bootstrap.settings.siteURL}catch(a){m("getSiteURL",`Error getting Site URL: ${a}`)}}function C(a,b){for(const c of embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels)if(c.sectionName===
a&&c.labelName===b)return c.labelValue||"";for(const c of embeddedservice_bootstrap.settings.standardLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";return""}function R(a){for(const b of embeddedservice_bootstrap.brandingData)if(b.n&&b.n===a)return b.v}function Ib(){const a=embeddedservice_bootstrap.settings.chatButtonPosition;if("string"===typeof a&&0<a.length){const b=a.split(",");2!==b.length?m("setButtonPositionStyles",`Invalid embeddedservice_bootstrap.settings.chatButtonPosition value specified: ${a}. Valid format is "25px, 30px".`):
(document.documentElement.style.setProperty("--eswButtonBottom",b[0].trim()),document.documentElement.style.setProperty("--eswButtonRight",b[1].trim()))}}function gb(){let a=w(),b=document.getElementById("embeddedMessagingIconContainer"),c=document.getElementById("embeddedMessagingIconChat"),d=document.createElement("div"),e=document.createElement("span"),h,l=1;if(a){c.style.display="none";d.setAttribute("class","embeddedMessagingLoadingSpinner");for(d.setAttribute("id","embeddedMessagingLoadingSpinner");13>
l;l++)h=document.createElement("div"),h.setAttribute("class","embeddedMessagingLoadingCircle"+l+" embeddedMessagingLoadingCircle"),d.appendChild(h);d.classList.add("embeddedMessagingIconLoading");a.classList.add("embeddedMessagingConversationButtonLoading");b.insertBefore(d,c);a.disabled=!0;e.className="slds-assistive-text";e.setAttribute("role","alert");e.innerHTML=C("EmbeddedMessagingPrechat","PrechatSubmitButtonLoading")||"Loading";d.appendChild(e)}}function hb(){if(!M)return!0;const a=Number(M.startTime),
b=Number(M.endTime),c=Date.now();return c>=a&&c<b?!0:!1}function Aa(){let a;if(M){var b=hb();b?a=Number(M.endTime):(a=Number(M.startTime),L("onEmbeddedMessagingBusinessHoursEnded"));isNaN(a)||(ca&&clearTimeout(ca),ca=setTimeout(()=>{clearTimeout(ca);ca=void 0;Jb(b);b?L("onEmbeddedMessagingBusinessHoursEnded"):L("onEmbeddedMessagingBusinessHoursStarted")},a-Date.now()))}}function Jb(a){a?(M=void 0,embeddedservice_bootstrap.utilAPI.hideChatButton(),za().then(Aa()).catch(b=>Xa(b))):(Z()||embeddedservice_bootstrap.utilAPI.showChatButton(),
Aa())}function Kb(){const a=!!navigator.userAgent.match(/iP(hone|ad|od)/i);var b=navigator.userAgent.match(/(?!=OS)(([0-9]){2})/i);b=b&&0<b.length?Number(b[0]):-1;const c=!!navigator.userAgent.match(/WebKit/i)&&!navigator.userAgent.match(/CriOS/i);return a&&c&&15<=b}function Z(){try{return embedded_svc&&embedded_svc.menu?!0:!1}catch(a){return!1}}function Da(a){const b=embeddedservice_bootstrap.settings.targetElement.children;let c;for(const d in b)c=b[d],c!==document.getElementById("embedded-messaging")&&
c!==embeddedservice_bootstrap.filePreviewFrame&&(c.inert=a)}function ib(){const a=document.querySelector('meta[name="viewport"]');a&&(a.setAttribute("content",da),da=void 0)}function v(a,b){sa.then(()=>{const c=A();if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),I()):r(`Embedded Messaging iframe not available for post message with method ${a}.`)})}
function U(a,b){Lb.then(()=>{const c=embeddedservice_bootstrap.siteContextFrame;if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),I()):r(`Embedded Messaging iframe not available for post message with method ${a}.`)})}function jb(){U("ESW_PREFETCH_LWR_RESOURCES")}function Mb(a){a||m("handleAuraSite","Failed to load aura app. Iframe is undefined.");
a.src=I()+"/embeddedService/embeddedService.app"}function Nb(a){let b=I();a||m("handleLWRSite","Failed to load LWR site. Iframe is undefined.");b.endsWith("/")||(b+="/");a.src=b+"?lwc.mode="+(embeddedservice_bootstrap.settings.devMode?"dev":"prod")}function Ea(){return new Promise((a,b)=>{try{let c=w(),d=A();if(c&&!c.classList.contains("embeddedMessagingConversationButtonLoaded")){if(q(z.JWT))return n("handleClick","Conversation button clicked but a JWT exists in web storage. Joining the existing conversation."),
F=q(z.JWT),kb(!1).then(()=>{a()}).catch(e=>{X();m("handleClick",e.message);b(e)});D(z.CONVERSATION_BUTTON_CLICK_TIME,Date.now(),!0,!0);gb();n("handleClick","Conversation button clicked");bb().then(()=>{a()}).catch(e=>{m("handleClick",e.message);b(e)});xb().catch(e=>{X();m("handleClick",e.message);b(e)})}else c&&c.classList.contains("embeddedMessagingConversationButtonLoaded")&&d&&d.classList&&d.classList.contains("isMaximized")?v("ESW_APP_MINIMIZE"):m("handleClick","Something went wrong handling button click event.")}catch(c){b(c)}})}
function Ob(a){let b=A();a&&a.key&&(a.key===ea.SPACE||a.key===ea.ENTER?(a.preventDefault(),Ea()):a.key===ea.TAB&&a.shiftKey&&b&&b.classList&&b.classList.contains("isMaximized")&&(a.preventDefault(),v("trapfocustolast")))}function Pb(){const a=document.getElementById("embeddedMessagingMinimizedNotification"),b=w();a&&a.parentNode.removeChild(a);b&&b.focus()}function Qb(a){if(a.key===ea.ENTER||a.key===ea.SPACE)a.preventDefault(),this.handleNotificationDimissButtonClick()}function kb(a){if(q(z.JWT))return gb(),
bb().catch(m),ab().then(b=>{la(a).then(c=>{ma(b,c,a)})}).catch(m)}function Q(a){n("resetClientToInitialState","Resetting client to initial state.");try{G(a),qb(),p()}catch(b){m("resetClientToInitialState",`Error on clearing web storage for the previously ended conversation: ${b}`)}fa&&"function"===typeof fa&&(fa(),fa=void 0);da&&ib();Fa.test(navigator.userAgent)&&Da(!1);embeddedservice_bootstrap.removeMarkup();y()===B.UNAUTH&&(embeddedservice_bootstrap.generateMarkup(),w()&&w().focus());n("resetClientToInitialState",
"Successfully reset client to initial state.")}function Rb(){const a=document.createElement("div");a.id="embeddedMessagingModalOverlay";return a}function ua(a,b){a&&pa.currentStateLogs.push(a);b&&pa.errorLogs.push(b);sa.then(()=>{v("EMBEDDED_MESSAGING_PUSH_PARENT_FRAME_LOGS",{pendingLogs:pa});Ja()})}function Ja(){pa={currentStateLogs:[],errorLogs:[]}}function Ga(){}function ya(a,b){A()?v("EMBEDDED_MESSAGING_CLEAR_USER_SESSION_EVENT",a):Q(b)}function eb(a){return new Promise(b=>{n("renewAuthenticatedJwt",
"Renewing Authenticated JWT");Ya().then(()=>{lb(a);b()})})}function lb(a){a&&ba(a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody).then(b=>{a.resolve&&"function"===typeof a.resolve&&a.resolve(b)}).catch(b=>oa(b,a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody))}function db(a){if(a){L("onEmbeddedMessagingIdentityTokenExpired");var b=new Promise(d=>{ha=d}),c=new Promise((d,e)=>{setTimeout(()=>{e()},3E4)});Promise.race([b,c]).then(()=>{n("handleIdentityTokenExpiry","Valid identity token found. Fetch authenticated JWT.");
a.apiPath.includes("/accessToken")?(a.requestBody.customerIdentityToken=J,lb(a)):eb(a)}).catch(()=>{m("handleIdentityTokenExpiry","Failed to fetch authenticated JWT due to setIdentityToken timeout or other error. Clearing the messaging session on all tabs.");ya(!1,!1)})}}function Sa(){let a;Q(!1);embeddedservice_bootstrap.generateMarkup();a=w();var b=document.getElementById("embeddedMessagingIconChat");var c=document.getElementById("embeddedMessagingIconContainer");if(a){a.style.display="block";a.setAttribute("tabindex",
-1);a.style.setProperty("cursor","default");a.classList.add("no-hover");c&&b&&c.removeChild(b);b=xa(qa.REFRESH);b.setAttribute("id","embeddedMessagingIconRefresh");b.setAttribute("class","embeddedMessagingIconRefresh");c.appendChild(b);c=document.createElement("div");b=document.createElement("div");const e=document.createElement("span"),h=document.createElement("span");var d=document.createElement("button");const l=document.createElement("span"),k=document.createElement("span");d.className="embeddedMessagingMinimizedNotificationDismissButton";
d.addEventListener("click",Pb);d.addEventListener("keydown",Qb);d.setAttribute("aria-describedby","dismissButton-help");l.className="embeddedMessagingMinimizedNotificationDismissButtonText";l.title=C("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";l.innerHTML=C("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";l.style.setProperty("font-family",R("font"));k.className="slds-assistive-text";k.id="dismissButton-help";k.innerHTML=C("EmbeddedMessagingMinimizedState",
"MinimizedNotificationDismissButtonAssistiveText")||"Close the chat notification";d.appendChild(l);d.appendChild(k);c.id="embeddedMessagingMinimizedNotification";c.className="embeddedMessagingMinimizedNotification";b.className="embeddedMessagingMinimizedNotificationTextWrapper";e.className="embeddedMessagingMinimizedNotificationText";e.role="status";e.title=C("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";
e.innerHTML=C("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";e.style.setProperty("font-family",R("font"));h.className="slds-assistive-text";h.innerHTML=C("EmbeddedMessagingMinimizedState","MinimizedNotificationAssistiveText")||"Expand the text.";b.appendChild(e);b.appendChild(h);c.appendChild(b);c.appendChild(d);a.disabled=!0;embeddedservice_bootstrap.settings.targetElement.appendChild(c)}}function mb(a){a=
a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(window.atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}function na(a){let b,c;try{return b=mb(a),c=Math.floor(Date.now()/1E3)<b.exp,embeddedservice_bootstrap.settings.devMode&&!c&&n("validateJwt",`JWT has expired at ${(new Date(1E3*b.exp)).toString()}`),c}catch(d){return embeddedservice_bootstrap.settings.devMode&&m("validateJwt",`JWT validation failed: ${d.message}`),
!1}}function y(){let a=null;try{a=embeddedservice_bootstrap.settings.embeddedServiceConfig&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode}catch(b){m("getAuthMode",`Failed to retrieve auth mode flag: ${b.message}`)}return a}function ia(){}function nb(a,b,c,d){const e="setHiddenPrechatFields"===a;var h=e?Sb():T();const l=h.map(({name:k})=>k);h=h.find(k=>k.name===
b);if(!l.includes(b))return m("validatePrechatField",`${a} called with an invalid field name ${b}.`),!1;if("string"===typeof c&&(c.toLowerCase().includes("javascript:")||c.toLowerCase().includes("<script>")))return m("validatePrechatField",`JavaScript isn't allowed in the value for the ${b} field when calling ${a}.`),!1;if(e){if(c.length>h.maxLength)return m("validatePrechatField",`Value for the ${b} field in ${a} exceeds the maximum length restriction of ${h.maxLength} characters.`),!1;if("string"!==
typeof c)return m("validatePrechatField",`You must specify a string for the ${b} field in ${a} instead of a ${typeof c} value.`),!1}return d&&"boolean"!==typeof d?(m("validatePrechatField","setVisiblePrechatFields was called with isEditableByEndUser set to a value that\u2019s not boolean. Enter a boolean value."),!1):!0}function Sb(){let a=[];var b=Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&
Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields)?!0:!1;b&&(a=embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields);return a}function T(){return Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields.length?
embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields:[]}function ra(a){return H?!0:(m("shouldProcessPrechatFieldsFromHost",`Can't call ${a} before the onEmbeddedMessagingReady event is fired.`),!1)}function Fb(a){return"string"===typeof a&&0<a.trim().length?!0:!1}function rb(){T().forEach(a=>{delete a.value;delete a.isEditableByEndUser})}function Ha(){}function ob(a){return H?!0:(m("shouldProcessAutoResponseParametersFromHost",`[${a}] Cannot invoke Auto-Response API before the onEmbeddedMessagingReady event is fired.`),
!1)}function ja(){}function x(){this.settings={devMode:!1,targetElement:document.body};this.isSessionStorageAvailable=this.isLocalStorageAvailable=!0;Object.defineProperties(qa,{CHAT:{value:"M50 0c27.614 0 50 20.52 50 45.833S77.614 91.667 50 91.667c-8.458 0-16.425-1.925-23.409-5.323-13.33 6.973-21.083 9.839-23.258 8.595-2.064-1.18.114-8.436 6.534-21.767C3.667 65.54 0 56.08 0 45.833 0 20.52 22.386 0 50 0zm4.583 61.667H22.917a2.917 2.917 0 000 5.833h31.666a2.917 2.917 0 000-5.833zm12.5-15.834H22.917a2.917 2.917 0 000 5.834h44.166a2.917 2.917 0 000-5.834zM79.583 30H22.917a2.917 2.917 0 000 5.833h56.666a2.917 2.917 0 000-5.833z"},
MINIMIZE_MODAL:{value:"M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2 c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"},REFRESH:{value:"M46.5,4h-3C42.7,4,42,4.7,42,5.5v7c0,0.9-0.5,1.3-1.2,0.7l0,0c-0.3-0.4-0.6-0.7-1-1c-5-5-12-7.1-19.2-5.7 c-2.5,0.5-4.9,1.5-7,2.9c-6.1,4-9.6,10.5-9.7,17.5c-0.1,5.4,2,10.8,5.8,14.7c4,4.2,9.4,6.5,15.2,6.5c5.1,0,9.9-1.8,13.7-5 c0.7-0.6,0.7-1.6,0.1-2.2l-2.1-2.1c-0.5-0.5-1.4-0.6-2-0.1c-3.6,3-8.5,4.2-13.4,3c-1.3-0.3-2.6-0.9-3.8-1.6 C11.7,36.6,9,30,10.6,23.4c0.3-1.3,0.9-2.6,1.6-3.8C15,14.7,19.9,12,25.1,12c4,0,7.8,1.6,10.6,4.4c0.5,0.4,0.9,0.9,1.2,1.4 c0.3,0.8-0.4,1.2-1.3,1.2h-7c-0.8,0-1.5,0.7-1.5,1.5v3.1c0,0.8,0.6,1.4,1.4,1.4h18.3c0.7,0,1.3-0.6,1.3-1.3V5.5 C48,4.7,47.3,4,46.5,4z"}});
this.brandingData=[]}function Tb(){const a=document.createElement("iframe"),b=new URL(`${I()}/assets/htdocs/sitecontext${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);embeddedservice_bootstrap.settings.devMode&&b.searchParams.set("dev_mode",!0);a.classList.add("embeddedMessagingSiteContextFrame");a.id="embeddedMessagingSiteContextFrame";a.name="embeddedMessagingSiteContextFrame";a.src=b.href;a.onload=()=>{n("createSiteContextFrame",
"Created an iframe for siteContext.")};embeddedservice_bootstrap.siteContextFrame=a;document.body.appendChild(a)}const qa={};class $a{static isValidContrastRatio(a,b,c=3){return this.getContrastRatio(a,b)>=c}static getContrastRatio(a,b){a=this.convertHexToRGB(a);b=this.convertHexToRGB(b);a=this.getRelativeLuminance(a);b=this.getRelativeLuminance(b);return((Math.max(a,b)+.05)/(Math.min(a,b)+.05)).toFixed(2)}static getRelativeLuminance(a){const [b,c,d]=Object.values(a).map(e=>this.getSRGB(e));return.2126*
b+.7152*c+.0722*d}static getSRGB(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}static convertHexToRGB(a){const b=parseInt(a.slice(1,3),16),c=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return{r:b,g:c,b:a}}}const Ub=".salesforce.com .force.com .sfdc.net .site.com .salesforce-sites.com .crm.dev".split(" "),Ca={JWT:"JWT"},Ta=document.title;let Y,H=!1,N=!1,K={},V={},F,J,u,E,ta,sa=new Promise(a=>{ta=a}),Pa;const Lb=new Promise(a=>{Pa=a});let Qa,Vb=new Promise(a=>{Qa=a}),da,M,
ca;const z={JWT:"JWT",FAILED_OUTBOUND_MESSAGE_ENTRIES:"FAILED_MESSAGES",CONVERSATION_BUTTON_CLICK_TIME:"CONVERSATION_BUTTON_CLICK_TIME"},ea={ENTER:"Enter",TAB:"Tab",SPACE:" "},Fa=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i;let fa,
ha,pa={currentStateLogs:[],errorLogs:[]},Ra,pb=new Promise(a=>{Ra=a});x.prototype.removeEventHandlers=function(){window.removeEventListener("message",Ma);window.removeEventListener("storage",Na)};x.prototype.emitEmbeddedMessagingReadyEvent=function(){H=!0;try{L("onEmbeddedMessagingReady")}catch(a){H=!1,m("emitEmbeddedMessagingReadyEvent",`Something went wrong in firing onEmbeddedMessagingReady event ${a}.`)}};x.prototype.removeMarkup=function(a){const b=A(),c=w(),d=document.getElementById("embeddedMessagingModalOverlay"),
e=document.getElementById("embeddedMessagingMinimizedNotification"),h=document.getElementById("embedded-messaging"),l=document.getElementById("inert-script");b?b.parentNode.removeChild(b):r("Embedded Messaging iframe not available for resetting the client to initial state.");embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.parentNode?embeddedservice_bootstrap.filePreviewFrame.parentNode.removeChild(embeddedservice_bootstrap.filePreviewFrame):r("Embedded Messaging file preview iframe not available for resetting the client to initial state.");
a&&embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.parentNode?embeddedservice_bootstrap.siteContextFrame.parentNode.removeChild(embeddedservice_bootstrap.siteContextFrame):r("Embedded Messaging site context iframe not available for resetting the client to initial state.");d&&d.parentNode.removeChild(d);document.body.classList.contains("embeddedMessagingPreventScrolling")&&(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&
window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));c?c.parentNode.removeChild(c):r("Embedded Messaging static button not available for resetting the client to initial state.");e&&e.parentNode.removeChild(e);h&&h.parentNode.removeChild(h);l&&l.parentNode.removeChild(l);embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent()};const B={AUTH:"Auth",UNAUTH:"UnAuth"};Ga.prototype.setIdentityToken=function(a){let b;if(!H)return m("setIdentityToken","Method can\u2019t be invoked before the onEmbeddedMessagingReady event is fired."),
!1;if(y()!==B.AUTH)return m("setIdentityToken","User Verification isn\u2019t enabled in Messaging Settings."),!1;if(!a||null===a||"object"!==typeof a)return m("setIdentityToken","Invalid identity token parameter passed into the setIdentityToken method. Specify a valid object containing the token data."),!1;b=a.identityTokenType;a=a.identityToken;if("string"!==typeof b||b.trim().toUpperCase()!==Ca.JWT)return m("setIdentityToken","Unsupported identity token. Only JWT-based identity tokens are supported."),
!1;let c=!1;switch(b){case Ca.JWT:c=na(a)}if(!c)return m("setIdentityToken","Invalid identity token passed into the setIdentityToken method."),!1;J=a;ha&&"function"===typeof ha&&(ha(),ha=void 0);A()?v("EMBEDDED_MESSAGING_SET_IDENTITY_TOKEN_EVENT",J):w()?w()&&document.getElementById("embeddedMessagingIconRefresh")&&(embeddedservice_bootstrap.removeMarkup(),embeddedservice_bootstrap.generateMarkup()):embeddedservice_bootstrap.generateMarkup();return!0};Ga.prototype.clearSession=function(){return new Promise((a,
b)=>{fa=a;H?ya(y()===B.AUTH,!1):(b("Method can't be invoked before the onEmbeddedMessagingReady event is fired."),m("clearSession","Method cannot be invoked before the onEmbeddedMessagingReady event is fired."))})};ia.prototype.setHiddenPrechatFields=function(a){if(ra("setHiddenPrechatFields"))if(a&&"object"===typeof a)for(const [b,c]of Object.entries(a))nb("setHiddenPrechatFields",b,c)&&(K[b]=c,n("setHiddenPrechatFields",`[setHiddenPrechatFields] Successfully updated Hidden Pre-Chat field ${b}.`));
else m("setHiddenPrechatFields","When calling setHiddenPrechatFields, you must pass in an object with key-value pairs.")};ia.prototype.removeHiddenPrechatFields=function(a){ra("removeHiddenPrechatFields")&&(a&&Array.isArray(a)?a.forEach(function(b){K.hasOwnProperty(b)?(delete K[b],n("removeHiddenPrechatFields",`[removeHiddenPrechatFields] Successfully removed Hidden Pre-Chat field ${b}.`)):m("removeHiddenPrechatFields",`removeHiddenPrechatFields called with an invalid field name ${b}.`)}):m("removeHiddenPrechatFields",
"When calling removeHiddenPrechatFields, you must pass in an array of fields."))};ia.prototype.setVisiblePrechatFields=function(a){if(ra("setVisiblePrechatFields")){var b=T();if(a&&"object"===typeof a&&!Array.isArray(a)){a=Object.entries(a);for(const [c,d]of a)if(nb("setVisiblePrechatFields",c,d.value,d.isEditableByEndUser)){const e=b.find(h=>h.name===c);e.value=d.value;"boolean"===typeof d.isEditableByEndUser&&(e.isEditableByEndUser=d.isEditableByEndUser);n("setVisiblePrechatFields",`[setVisiblePrechatFields] Successfully updated Visible Pre-Chat field ${c}.`)}a.length&&
pb.then(()=>{v("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",T())})}else m("setVisiblePrechatFields","setVisiblePrechatFields was called with an invalid object. Pass in an object with key-value pairs.")}};ia.prototype.unsetVisiblePrechatFields=function(a){if(ra("unsetVisiblePrechatFields")){var b=T();a&&Array.isArray(a)&&a.length?(a.forEach(c=>{const d=b.find(e=>e.name===c);d?(delete d.value,delete d.isEditableByEndUser,n("unsetVisiblePrechatFields",`[unsetVisiblePrechatFields] Successfully unset Visible Pre-Chat field ${c}.`)):
m("unsetVisiblePrechatFields",`unsetVisiblePrechatFields was called with an invalid field name: ${c}. Enter a valid field name to remove.`)}),pb.then(()=>{v("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",T())})):m("unsetVisiblePrechatFields","When calling unsetVisiblePrechatFields, you must pass in an array of fields.")}};Ha.prototype.setAutoResponseParameters=function(a){if(ob("setAutoResponseParameters"))if(a&&"object"===typeof a)for(const [c,d]of Object.entries(a)){a=c;var b=d;"string"!==typeof a||
1>a.trim().length?(m("validateAutoResponseParameter",`Expected a non-empty string for the parameter name, but received ${typeof a}`),a=!1):"string"!==typeof b||1>b.trim().length?(m("validateAutoResponseParameter",`Expected a non-empty string for the parameter value, but received ${typeof b}`),a=!1):a=!0;a?(V[c]=d,n("setAutoResponseParameters",`[setAutoResponseParameters] Successfully updated auto-response parameter ${c}`)):r(`[setAutoResponseParameters] Failed to validate auto-response parameter ${c}`)}else m("setAutoResponseParameters",
"[setAutoResponseParameters] Must pass in an object of parameters as key-value pairs.")};Ha.prototype.removeAutoResponseParameters=function(a){ob("removeAutoResponseParameters")&&(a&&Array.isArray(a)?a.forEach(function(b){V.hasOwnProperty(b)?(delete V[b],n("removeAutoResponseParameters",`[removeAutoResponseParameters] Successfully removed auto-response parameter ${b}`)):r(`[removeAutoResponseParameters] Failed to validate auto-response parameter ${b}`)}):m("removeAutoResponseParameters","[removeAutoResponseParameters] Must pass in an array of parameter names."))};
ja.prototype.prefetchResources=jb;ja.prototype.showChatButton=function(){var a=y();if(!H)return m("showChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(a===B.UNAUTH||J){if(a=w())return a.style.display="block",!0}else m("showChatButton","Can't call showChatButton for a verified user before calling the setIdentity method with a valid token.");return!1};ja.prototype.hideChatButton=function(){if(!H)return m("hideChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),
!1;if(A())m("hideChatButton","Can\u2019t call hideChatButton once the messaging window is showing.");else{const a=w();if(a)return a.style.display="none",!0}return!1};ja.prototype.launchChat=function(){return new Promise((a,b)=>{let c;const d=()=>{let h;N?(h="[Launch Chat API] Successfully initialized the messaging client.",n("launchChat",h),a(h),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e)):(h="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",
r(h),b(h))},e=()=>{let h;N?(h="[Launch Chat API] Error launching the messaging client.",m("handleBootstrapError",h),b(h),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e),Q()):(h="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",r(h),b(h))};try{if(H){if(!w())if(Z())y()===B.UNAUTH&&embeddedservice_bootstrap.generateMarkup(!0);else{c="[Launch Chat API] Default chat button isn\u2019t present. Check if the messaging client initialized successfully.";
r(c);b(c);return}if(A()){let h=A();h&&h.classList&&h.classList.contains("isMinimized")?(v("ESW_APP_MAXIMIZE"),n("launchChat","[Launch Chat API] Successfully maximized the messaging client."),a("[Launch Chat API] Successfully maximized the messaging client.")):(c="[Launch Chat API] The messaging client window is already present and maximized.",n("launchChat",c),r(c),a(c))}else window.addEventListener("onEmbeddedMessagingInitSuccess",d),window.addEventListener("onEmbeddedMessagingInitError",e),Ea().catch(h=>
{c=`[Launch Chat API] Error when API simulates clicking the custom messaging client button: ${h}`;m("launchChat",c);b(c)})}else c="[Launch Chat API] Can\u2019t invoke API before the onEmbeddedMessagingReady event is fired.",r(c),b(c)}catch(h){c=`[Launch Chat API] Something went wrong launching the API: ${h}`,m("launchChat",c),b(c)}})};x.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};x.prototype.getKeyPrefix=function(a){if(embeddedservice_bootstrap.isValidEntityId(a))return a.substr(0,
3)};x.prototype.isOrganizationId=function(a){return"00D"===embeddedservice_bootstrap.getKeyPrefix(a)};x.prototype.isMessageFromSalesforceDomain=function(a){var b=a.split(":")[1].replace("//","");if(va()&&b===document.domain)return!0;var c=function(d,e){return-1!==d.indexOf(e,d.length-e.length)};return Ub.some(function(d){return c(b,d)})};x.prototype.generateMarkup=function(a=!1){var b=document.createDocumentFragment(),c=document.getElementById("embedded-messaging"),d=w();if(!Z()||a)if(!c||!d){c=document.createElement("div");
c.id="embedded-messaging";c.className="embedded-messaging";a=document.createElement("div");d=document.createElement("button");$a.isValidContrastRatio("#FFFFFF",R("headerColor"))||document.documentElement.style.setProperty("--eswIconFillColor","#1A1B1E");var e=document.createElement("div");const h=xa(qa.CHAT);h.setAttribute("id","embeddedMessagingIconChat");h.setAttribute("class","embeddedMessagingIconChat");e.id="embeddedMessagingIconContainer";e.className="embeddedMessagingIconContainer";e.appendChild(h);
a.className="embeddedMessagingConversationButtonWrapper";d.classList.add("embeddedMessagingConversationButton");d.id="embeddedMessagingConversationButton";d.href="javascript:void(0)";d.addEventListener("click",Ea);d.addEventListener("keydown",Ob);d.setAttribute("tabindex",0);d.setAttribute("role","button");d.setAttribute("aria-label",C("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.setAttribute("title",C("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||
"Hello, have a question? Let\u2019s chat.");d.style.setProperty("--eswHeaderColor",R("headerColor"));d.style.setProperty("--eswSecondaryColor",R("secondaryColor"));embeddedservice_bootstrap.settings.hasBottomTabBar&&d.classList.add("embeddedMessagingBottomTabBar");("boolean"===typeof embeddedservice_bootstrap.settings.hideChatButtonOnLoad?embeddedservice_bootstrap.settings.hideChatButtonOnLoad:Z()||!hb())&&!q(z.JWT)&&(d.style.display="none");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&
"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());(void 0!==window.LWR||va())&&d.classList.add("experienceSite");d.appendChild(e);a.appendChild(d);d=a;b.appendChild(c);c.appendChild(d);embeddedservice_bootstrap.settings.targetElement.appendChild(b);document.getElementById("inert-script")||(b=document.createElement("script"),c=`${I()}/assets/js/inert${embeddedservice_bootstrap.settings.devMode?
"":".min"}.js`,b.id="inert-script",b.type="text/javascript",b.src=c,embeddedservice_bootstrap.settings.targetElement.appendChild(b))}};x.prototype.createFilePreviewFrame=function(){const a=document.createElement("iframe"),b=new URL(`${I()}/assets/htdocs/filepreview${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);a.classList.add("embeddedMessagingFilePreviewFrame");a.id="embeddedMessagingFilePreviewFrame";a.name="embeddedMessagingFilePreviewFrame";
a.src=b.href;a.title=C("EmbeddedMessagingIframesAndContents","FilePreviewIframeTitle")||"Enlarged image preview";a.onload=()=>{n("createFilePreviewFrame","Created an iframe for file preview.")};embeddedservice_bootstrap.filePreviewFrame=a;document.body.appendChild(a)};x.prototype.createIframe=function(){return new Promise((a,b)=>{try{const c=document.getElementById("embedded-messaging"),d=document.createElement("iframe"),e=Rb();d.title=C("EmbeddedMessagingIframesAndContents","MessagingIframeTitle")||
"Chat with an Agent";d.className="embeddedMessagingFrame";d.id="embeddedMessagingFrame";d.onload=a;d.onerror=b;d.style.backgroundColor="transparent";d.allowTransparency="true";d.setAttribute("aria-label",C("EmbeddedMessagingChatHeader","ChatWindowAssistiveText")||"Chat Window");d.setAttribute("role","dialog");d.setAttribute("aria-modal","true");embeddedservice_bootstrap.settings.omitSandbox||(d.sandbox="allow-scripts allow-same-origin allow-modals allow-downloads allow-popups allow-popups-to-escape-sandbox");
embeddedservice_bootstrap.settings.isAuraSite?Mb(d):Nb(d);embeddedservice_bootstrap.settings.hasBottomTabBar&&(d.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),d.classList.add("embeddedMessagingFrameMaximizedBottomTabBar"));navigator.userAgent.includes("CommunityHybridContainer")||navigator.userAgent.includes("playgroundcommunity")?d.classList.add("mobilePublisher"):(void 0!==window.LWR||va())&&d.classList.add("experienceSite");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&
"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());d.onload=()=>{n("createIframe","Created Embedded Messaging frame.")};c.appendChild(e);c.appendChild(d)}catch(c){b(c)}})};x.prototype.bootstrapEmbeddedMessaging=function(){try{return embeddedservice_bootstrap.utilAPI.launchChat()}catch(a){throw Error("[Bootstrap API] Something went wrong bootstrapping Embedded Messaging: "+
a);}};x.prototype.maximizeIframe=function(a){const b=w();var c=document.getElementById("embeddedMessagingModalOverlay");const d=document.getElementById("embeddedMessagingIconChat"),e=document.getElementById("embeddedMessagingIconContainer"),h=document.querySelector('meta[name="viewport"]'),l=!!navigator.userAgent.match(/iP(hone|ad|od)/i);a&&(a.classList.add("isMaximized"),a.classList.remove("isMinimized"),a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&
(a.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMaximizedBottomTabBar")));b&&(b.style.display="none",b.setAttribute("tabindex",-1),b.setAttribute("aria-label",C("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),b.setAttribute("title",C("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),d.style.display="none",document.getElementById("embeddedMessagingIconMinimize")||
(a=xa(qa.MINIMIZE_MODAL),a.setAttribute("id","embeddedMessagingIconMinimize"),a.setAttribute("class","embeddedMessagingIconMinimize"),e.insertBefore(a,d)));c&&!c.classList.contains("isMaximized")&&c.classList.add("isMaximized");-1===navigator.userAgent.indexOf("Mobi")||document.body.classList.contains("embeddedMessagingPreventScrolling")||(document.scrollingElement?embeddedservice_bootstrap.documentScrollPosition=document.scrollingElement.scrollTop:(c=document.documentElement.getBoundingClientRect(),
embeddedservice_bootstrap.documentScrollPosition=Math.abs(c.top)),document.body.classList.add("embeddedMessagingPreventScrolling"));l&&h&&(da=h.content,h.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1"));Fa.test(navigator.userAgent)&&Da(!0);v("ESW_APP_MAXIMIZATION_RESIZING_COMPLETED");n("maximizeIframe","Maximized the app")};x.prototype.minimizeIframe=function(a,b){const c=w(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingIconMinimize");
b=b.hasMinimizedNotification;a&&(a.classList.remove("isMaximized"),a.classList.add("isMinimized"),b?a.classList.add("hasMinimizedNotification"):a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMaximizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMinimizedBottomTabBar")));e&&e.remove();c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.removeAttribute("title"),c.removeAttribute("aria-label"));
d&&d.classList.contains("isMaximized")&&d.classList.remove("isMaximized");-1!==navigator.userAgent.indexOf("Mobi")&&(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));da&&ib();Fa.test(navigator.userAgent)&&Da(!1);v("ESW_APP_MINIMIZATION_RESIZING_COMPLETED");n("minimizeIframe","Minimized the app")};x.prototype.initializeFeatureObjects=function(){embeddedservice_bootstrap.prechatAPI=
new ia;embeddedservice_bootstrap.autoResponseAPI=new Ha;embeddedservice_bootstrap.userVerificationAPI=new Ga;embeddedservice_bootstrap.utilAPI=new ja};x.prototype.init=function(a,b,c,d){try{embeddedservice_bootstrap.settings.orgId=a;embeddedservice_bootstrap.settings.eswConfigDevName=b;embeddedservice_bootstrap.settings.siteURL=c;embeddedservice_bootstrap.settings.snippetConfig=d;E=Ka();n("init",`Initialized a new conversationId: ${E}`);La(d||{});if("string"!==typeof embeddedservice_bootstrap.settings.siteURL||
!embeddedservice_bootstrap.settings.siteURL.length)throw Error(`Expected a valid Site URL value to be a string but received: ${embeddedservice_bootstrap.settings.siteURL}.`);if("string"!==typeof embeddedservice_bootstrap.settings.scrt2URL||!embeddedservice_bootstrap.settings.scrt2URL.length)throw Error(`Expected a valid SCRT 2.0 URL value to be a string but received: ${embeddedservice_bootstrap.settings.scrt2URL}.`);if(!embeddedservice_bootstrap.settings.orgId||!embeddedservice_bootstrap.isOrganizationId(embeddedservice_bootstrap.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+
embeddedservice_bootstrap.settings.orgId);if("string"!==typeof embeddedservice_bootstrap.settings.eswConfigDevName||!embeddedservice_bootstrap.settings.eswConfigDevName.length)throw Error(`Expected a valid ESW Config Dev Name value to be a string but received: ${embeddedservice_bootstrap.settings.eswConfigDevName}.`);try{window.localStorage}catch(k){r("localStorage is not available. User chat sessions continue only in a single-page view and not across multiple pages."),embeddedservice_bootstrap.isLocalStorageAvailable=
!1}try{window.sessionStorage}catch(k){r("sessionStorage is not available. User chat sessions end after a web page refresh or across browser tabs and windows."),embeddedservice_bootstrap.isSessionStorageAvailable=!1}sb();if(!embeddedservice_bootstrap.settings.targetElement)throw Error("No targetElement specified.");tb();Ib();embeddedservice_bootstrap.settings.hasBottomTabBar=Kb();embeddedservice_bootstrap.settings.isAuraSite=!!embeddedservice_bootstrap.settings.isAuraSite;embeddedservice_bootstrap.settings.omitSandbox=
!!embeddedservice_bootstrap.settings.omitSandbox;embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel=!!embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel;embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab=!!embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab;const e=Ua().then(Promise.resolve.bind(Promise),()=>Ua(I())).catch(()=>{throw Error("Error loading CSS.");}),h=Va().then(k=>{n("init","Successfully retrieved configuration settings");
La(k);k=embeddedservice_bootstrap.settings.embeddedServiceConfig;embeddedservice_bootstrap.brandingData=k&&k.branding?k.branding:[];embeddedservice_bootstrap.settings.embeddedServiceConfig.scrt2URL=embeddedservice_bootstrap.settings.scrt2URL;embeddedservice_bootstrap.settings.embeddedServiceConfig.orgId=embeddedservice_bootstrap.settings.orgId;if(!embeddedservice_bootstrap.settings.embeddedServiceConfig)throw Error("Embedded Service Config settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.name)throw Error("Embedded Service Config developer name not present in configuration response.");
if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel)throw Error("Embedded Service Messaging Channel settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode)throw Error("Auth mode setting not present in configuration response.");if(!Object.values(B).includes(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode))throw Error("Auth mode in configuration response is invalid.");
u=`${embeddedservice_bootstrap.settings.orgId}_WEB_STORAGE`;Tb()},k=>{m("init","Failed to retrieve configuration settings. Retrying the request");return new Promise((O,P)=>{Va().then(O,P)})}).catch(()=>{throw Error("Unable to load Embedded Messaging configuration.");});h.then(()=>{U("ESW_3RDPARTY_STORAGE_REQUEST",{orgId:embeddedservice_bootstrap.settings.orgId});embeddedservice_bootstrap.settings.disablePrefetch||jb()});const l=za().then(Promise.resolve.bind(Promise),k=>Xa(k)).catch(k=>{m("init",
"Failed to retrieve Business Hours data.",k);throw Error("Failed to retrieve Business Hours data.");});Promise.all([e,h,l,Vb]).then(()=>{p();if(embeddedservice_bootstrap.isLocalStorageAvailable){var k=Object.keys(JSON.parse(localStorage.getItem(u)));n("logWebStorageItemsOnInit",`Local storage items on init: ${k}`)}embeddedservice_bootstrap.isSessionStorageAvailable&&(k=Object.keys(JSON.parse(sessionStorage.getItem(u))),n("logWebStorageItemsOnInit",`Session storage items on init: ${k}`));embeddedservice_bootstrap.initializeFeatureObjects();
embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();if(q(z.JWT)){{F=q(z.JWT);k=embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||"";const O=(mb(F)||{}).channelAddId||"";embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel&&k!==O?embeddedservice_bootstrap.userVerificationAPI.clearSession():(embeddedservice_bootstrap.generateMarkup(!0),kb(!0))}}else y()===B.UNAUTH&&embeddedservice_bootstrap.generateMarkup()})}catch(e){m("init",
`Error: ${e}`)}};window.embeddedservice_bootstrap=new x})();
